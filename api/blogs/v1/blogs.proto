syntax = "proto3";

package blogs.v1;

import "google/api/annotations.proto";
import "protoc-gen-openapiv2/options/annotations.proto";

option go_package = "api/blogs/v1";

// Сервис для работы со статьями
service BlogService {
    rpc GetTopBlogs(GetTopBlogsRequest) returns(GetTopBlogsResponse)  {
        option (google.api.http) = {
            get: "/api/v1/blogs/top"
        };
        option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
            summary: "Топ-3 или топ статей, для главной и тд"
        };
    }
    rpc GetBlogs(GetBlogsRequest) returns(GetBlogsResponse)  {
        option (google.api.http) = {
            get: "/api/v1/blogs"
        };
        option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
            summary: "Все статьи"
        };
    }
    rpc GetDoctorBlogs(GetDoctorBlogsRequest) returns(GetDoctorBlogsResponse)  {
        option (google.api.http) = {
            get: "/api/v1/blogs/doctor/{doctor_slug}"
        };
        option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
            summary: "Статьи определенного доктора"
        };
    }
    rpc GetBlogDetail(GetBlogDetailRequest) returns(GetBlogDetailResponse)  {
        option (google.api.http) = {
            get: "/api/v1/blog/{blog_slug}"
        };
        option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
            summary: "Конкретная статья по слагу"
        };
    }
    rpc GetBlogsCategories(GetBlogsCategoriesRequest) returns(GetBlogsCategoriesResponse)  {
        option (google.api.http) = {
            get: "/api/v1/blogs/categories"
        };
        option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
            summary: "Получения категорий статей"
        };
    }
    rpc FilterBlogs(FilterBlogsRequest) returns(FilterBlogsResponse)  {
        option (google.api.http) = {
            post: "/api/v1/blogs/filter"
            body: "*"
        };
        option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
            summary: "Фильтрация категорий по каким-то критериям"
        };
    }
}

message Category {
  int64 id = 1;
  string name = 2;
  string font_color = 3;
  string bg_color = 4;
}

message BlogMiniatures {
    string title = 1;
    string slug = 2;
    string preview_text = 3;
    string created_at = 4;
    string photo_link = 5;

    repeated Category categories = 6;
}

message GetTopBlogsRequest{}

message GetTopBlogsResponse{
    repeated BlogMiniatures blogs = 1;
}

message GetBlogsRequest{}

message GetBlogsResponse{
    repeated BlogMiniatures blogs = 1;
}

message GetBlogDetailRequest{
    string blog_slug = 1;
}

message GetBlogDetailResponse{
    string title = 1;
    string slug = 2;
    string body = 3;
    string preview_text = 4;
    string society_preview = 5;
    string additional_seo_text = 6;
    string created_at = 7;
    string photo_link = 8;
    Doctor doctor = 9;
    repeated Category categories = 10;

    message Doctor {
        string name = 1;
        string slug = 2;
        string image = 3;
        string speciality_name = 4;
    }
}

message GetDoctorBlogsRequest {
    string doctor_slug = 1;
}

message GetDoctorBlogsResponse {
    repeated BlogMiniatures blogs = 1;
}

message GetBlogsCategoriesRequest {}
message GetBlogsCategoriesResponse {
    repeated Category categories = 1;
    int64 all_blogs_count = 2;

    message Category {
        int64 id = 1;
        string name = 2;
        string font_color = 3;
        string bg_color = 4;
        int64 blogs_count = 5;
    }
}

message FilterBlogsRequest {
  repeated int64 categories_ids = 1;
}

message FilterBlogsResponse {
    repeated BlogMiniatures blogs = 1;
}